<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="php反序列化漏洞（1）, shianer">
    <meta name="description" content="A Freshman">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>php反序列化漏洞（1） | shianer</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="shianer" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">shianer</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">shianer</div>
        <div class="logo-desc">
            
            A Freshman
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/8.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">php反序列化漏洞（1）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                                <span class="chip bg-color">php反序列化</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-30
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="php反序列化漏洞"><a href="#php反序列化漏洞" class="headerlink" title="php反序列化漏洞"></a>php反序列化漏洞</h1><p>做到一题PHP反序列化的题目，补充一下在这一块的薄弱：</p>
<p>参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42751456/article/details/88758908">https://blog.csdn.net/weixin_42751456/article/details/88758908</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/197496.html">实战经验丨PHP反序列化漏洞总结 - FreeBuf网络安全行业门户</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42263820/article/details/112719099">(37条消息) php反序列化姿势学习_彼岸花苏陌的博客-CSDN博客_php反序列化技巧</a></p>
<p>系列知识了解：火狐收藏夹-PHP反序列化考点（析构方法，越过wakeup,伪变量$this访问类方法中隐藏的变量成员（protected,private属性），+的利用，phpinput伪协议，简单pop链，反序列化字符逃逸）</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h2 id="1-序列化与反序列化"><a href="#1-序列化与反序列化" class="headerlink" title="1.序列化与反序列化"></a>1.序列化与反序列化</h2><h4 id="序列化："><a href="#序列化：" class="headerlink" title="序列化："></a>序列化：</h4><p>在计算机科学的数据处理中，是指将数据结构或对象状态转换成可取用格式（例如存成文件，存于缓冲，或经由网络中发送），以留待后续在相同或另一台计算机环境中，能恢复原先状态的过程。 序列化就是把一个对象转换成字符串。字符串包括属性名，属性值，属性类型和该对象对应的类名。概念很容易理解，其实就是将数据转化成一种可逆的数据结构。</p>
<h4 id="反序列化："><a href="#反序列化：" class="headerlink" title="反序列化："></a>反序列化：</h4><p>逆向的过程就叫做反序列化。反序列化相反将字符串恢复成对象。对象的序列化有利于对象的保存和传输，也可以让多个文件共享对象。</p>
<h4 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h4><p>序列化的目的是为了方便数据的 传输和存储。</p>
<h4 id="PHP反序列化和序列化："><a href="#PHP反序列化和序列化：" class="headerlink" title="PHP反序列化和序列化："></a>PHP反序列化和序列化：</h4><p>PHP中一般会用于做缓存，session缓存，cookie等等。</p>
<h6 id="1-常见的序列化格式"><a href="#1-常见的序列化格式" class="headerlink" title="1.常见的序列化格式"></a>1.常见的序列化格式</h6><p>字节数组，二进制格式，json字符串，xml字符串</p>
<h6 id="2-PHP常用的函数"><a href="#2-PHP常用的函数" class="headerlink" title="2.PHP常用的函数"></a>2.PHP常用的函数</h6><p>unserialize()  –&gt;反序列化</p>
<p>serialze() –&gt; 序列化</p>
<h4 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h4><h5 id="php序列化"><a href="#php序列化" class="headerlink" title="php序列化"></a>php序列化</h5><p>序列化函数serialize会检查类中是否存在一个魔术方法 __sleep()。如果存在，__sleep()方法会先被调用，然后才执行序列化操作。</p>
<p>可以再__sleep()方法里可以决定哪些属性被序列化,没有这个函数的不序列化。</p>
<p>如果没有__sleep()方法则默认序列化所有属性</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20133435.png" alt="屏幕截图 2022-01-30 133435"></p>
<p>O:3:”Ctf”:3{s:4:”flag”;s:13:”flag{abedyui}”;s:4:”name”;s:7:”Sch0lar”;s:3:”age”;s:2:”18”;}</p>
<p> O代表对象 因为我们序列化的是一个对象</p>
<p> 序列化数组则用A来表示 </p>
<p>3 代表类名字占三个字符  ctf 类名 </p>
<p>3 代表三个属性</p>
<p> s代表字符串 </p>
<p>4代表属性名长度</p>
<p> flag属性名</p>
<p> s:13:”flag{abedyui}” 字符串 属性值长度 属性值</p>
<p>还有一个知识点</p>
<h5 id="访问控制修饰符"><a href="#访问控制修饰符" class="headerlink" title="访问控制修饰符"></a>访问控制修饰符</h5><p>根据访问控制修饰符的不同 序列化后的 属性长度和属性值会有所不同,所以这里简单提一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public(公有)</span><br><span class="line">protected(受保护)</span><br><span class="line">private(私有的)</span><br></pre></td></tr></table></figure>

<p>protected属性被序列化的时候属性值会变成%00*%00属性名</p>
<p>private属性被序列化的时候属性值会变成%00类名%00属性名</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20134142-16435214557451.png" alt="屏幕截图 2022-01-30 134142"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;Ctf&quot;:3:&#123;s:4:&quot;name&quot;;s:7:&quot;Sch0lar&quot;;s:6:&quot;*age&quot;;s:2:&quot;19&quot;;s:9:&quot;Ctfflag&quot;;s:8:&quot;get flag&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s:6:&quot;*age&quot; //*前后出现了两个%00也就是空白符 一个%00长度为一 所以序列化后 该属性长度为6</span><br><span class="line">s:9:&quot;Ctfflag&quot; //ctf前后也就是类名前后出现两个%00 所以长度为9</span><br></pre></td></tr></table></figure>

<h5 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h5><p>反序列化函数unserialize()</p>
<p>反序列化就是将一个序列化的字符串，还原回去</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20135201.png" alt="屏幕截图 2022-01-30 135201"></p>
<p>与 序列化函数类似 unserialize() 会检查是否存在一个 __wakeup()魔术方法</p>
<p>如果存在则会先调用__wakeup()方法在进行反序列化</p>
<p>可以再wakeup()方法中对属性进行初始化或者改变。反序列化之前重新给flag属性赋值。当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过wakeup的执行。这个大家应该都知道很常见的姿势了。</p>
<p>影响版本：</p>
<ul>
<li>PHP before 5.6.25</li>
<li>7.x before 7.0.10</li>
</ul>
<h4 id="PHP反序列化漏洞原理："><a href="#PHP反序列化漏洞原理：" class="headerlink" title="PHP反序列化漏洞原理："></a>PHP反序列化漏洞原理：</h4><p>又称PHP对象注入，是因为程序对输入数据处理不当导致的。</p>
<p>利用考点：</p>
<h5 id="一、-wakeup-绕过"><a href="#一、-wakeup-绕过" class="headerlink" title="一、__wakeup( )绕过"></a><strong>一、__wakeup( )绕过</strong></h5><h5 id="二、注入对象构造方法"><a href="#二、注入对象构造方法" class="headerlink" title="二、注入对象构造方法"></a><strong>二、注入对象构造方法</strong></h5><p>当目标对象被private、protected修饰时的构造方法。</p>
<p>示例代码：</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20140822.png" alt="屏幕截图 2022-01-30 140822"></p>
<p>这个例子中，class B和class C有一个同名方法action，我们可以构造目标对象，使得析构函数调用class C的action方法，实现任意代码执行。</p>
<p>构造代码：</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20140950.png" alt="屏幕截图 2022-01-30 140950"></p>
<h5 id="三、Session反序列化漏洞"><a href="#三、Session反序列化漏洞" class="headerlink" title="三、Session反序列化漏洞"></a><strong>三、Session反序列化漏洞</strong></h5><p>PHP中的Session经序列化后存储，读取时再进行反序列化。</p>
<p>相关配置：</p>
<p><strong>session.save_path=””</strong>    //设置session的存储路径</p>
<p><strong>session.save_handler=””</strong>   //设定用户自定义存储函数，如果想使用PHP内置会话存储机制之外的可以使用本函数(数据库等方式) </p>
<p><strong>session.auto_start boolen</strong>  //指定会话模块是否在请求开始时启动一个会话默认为0不启动</p>
<p><strong>session.serialize_handler</strong> <strong>string</strong>//定义用来序列化/反序列化的处理器名字。默认使用php</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20141359.png" alt="屏幕截图 2022-01-30 141359"></p>
<p>命名为sess_Session_id。</p>
<p>存储内容为序列化后的session：test|s:4:”test”;</p>
<p>不同处理器的格式不同，当不同页面使用了不同的处理器时，由于处理的Session序列化格式不同，就可能产生反序列化漏洞。</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20141544.png" alt="屏幕截图 2022-01-30 141544"></p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20141639.png" alt="屏幕截图 2022-01-30 141639"></p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20141741.png" alt="屏幕截图 2022-01-30 141741"></p>
<h5 id="四、phar利用"><a href="#四、phar利用" class="headerlink" title="四、phar利用"></a>四、phar利用</h5><h6 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h6><p>是PHP里类似于JAR的一种打包文件，在PHP 5.3 或更高版本中默认开启，这个特性使得 PHP也可以像 Java 一样方便地实现应用程序打包和组件化。一个应用程序可以打成一个 Phar 包，直接放到 PHP-FPM 中运行。</p>
<h6 id="PHAR文件结构"><a href="#PHAR文件结构" class="headerlink" title="PHAR文件结构"></a>PHAR文件结构</h6><p>PHAR文件由3或4个部分组成： </p>
<p>（1）stub //PHAR文件头</p>
<p>stub就是一个简单的php文件，最简文件头为：</p>
<?php __HALT_COMPILER( )；?><p>是可有可无的，若使用?&gt;，则;与?&gt;间至多一个空格。</p>
<p>文件头中必须包含__HALT_COMPILER();除此之外没有限制。（PHP通过stub识别一个文件为PHAR文件，可以利用这点绕过文件上传检测）</p>
<p>（2）manifest describing the contents //PHAR文件描述该部分存储文件名、文件大小等信息，如下图所示。</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20142451.png" alt="屏幕截图 2022-01-30 142451"></p>
<p>（3）phar文件内容</p>
<p>（4）可选的签名部分，支持MD5和SHA1</p>
<h6 id="攻击方法"><a href="#攻击方法" class="headerlink" title="攻击方法"></a>攻击方法</h6><p>meta-data是任意能够序列化的PHP对象，当phar文件被任意文件系统函数首次通过后phar://协议解析时Meta-data部分会被反序列化，这个反序列化过程就是我们的攻击点，Meta-data部分填充payload。</p>
<p>漏洞利用条件： </p>
<p>在目标系统上投放一个装在payload的可访问的PHAR文件，通过文件系统函数利用phar://伪协议解析目标PHAR文件。</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20143032.png" alt="屏幕截图 2022-01-30 143032"></p>
<p>输出了之前打包的phar文件中，test.txt文件内容，并成功实例化TestObject对象，调用了析构函数。</p>
<p>由于PHP仅通过stub部分判断文件是否为PHAR文件，我们可以通过添加文件头、修改后缀的方式绕过上传检测。</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20143444.png" alt="屏幕截图 2022-01-30 143444"></p>
<p>而一切都要从类与对象说起：</p>
<h2 id="2-类与对象"><a href="#2-类与对象" class="headerlink" title="2.类与对象"></a>2.<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/oop5.intro.php">类与对象</a></h2><h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p>关于php面向对象编程：</p>
<h5 id="对象："><a href="#对象：" class="headerlink" title="对象："></a>对象：</h5><p>可以对其做事情的一些东西。一个对象有状态、行为和标识三种属性。</p>
<h5 id="类："><a href="#类：" class="headerlink" title="类："></a>类：</h5><p>一个共享相同结构和行为的对象的集合。</p>
<p>每个类的定义都以关键字class开头，后面跟着类的名字。一个类可以包含有属于自己的变量，变量（称为“属性”）以及函数（“称为方法”）。类定义了一件事物的抽象特点。通常来说，类定义了事物的属性和它可以做到的。类可能会包含一些特殊的函数叫magic函数，magic函数命名是以符号“_”开头的，比如_construct,_destruct,_toString,_sleep,_wakeup等。这些函数在某些情况下会自动调用，比如：_construct当一个对象创建时调用（constructor）；_destruct当一个对象被销毁时调用（destructor）；_toString当一个对象被当作一个字符串时使用。</p>
<h5 id="父类与子类"><a href="#父类与子类" class="headerlink" title="父类与子类"></a>父类与子类</h5><p>可以从另一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%B1%BB%E7%BB%A7%E6%89%BF&spm=1001.2101.3001.7020">类继承</a>一个类的成员，使用extends关键字为：class A extends B{}</p>
<p>继承其他属性的类称为子类(派生类，子类)，其属性被继承的类称为父类(基类，超类类)</p>
<p>子类中定义了构造函数则不会隐式调用其父类的构造函数。要执行父类的构造函数，需要在子类的构造函数中调用 **parent::__construct()**。如果子类没有定义构造函数则会如同一个普通的类方法一样从父类继承（假如没有被定义为 private 的话）。</p>
<p>public定义一个子类时，无法继承public父类中可打印出的private，会有一个致命的错误。</p>
<p>接口中定义的所有方法都必须是 public ，这是接口的特性。（下次有遇到再具体解释啦）</p>
<h5 id="构造函数与析解函数"><a href="#构造函数与析解函数" class="headerlink" title="构造函数与析解函数"></a>构造函数与析解函数</h5><p><strong>示例 #1 继承中的构造函数</strong></p>
<?php
class BaseClass {
  function __construct() {
    print "In BaseClass constructor\n";
  }
}

class SubClass extends BaseClass {
  function __construct() {
    parent::__construct();
    print "In SubClass constructor\n";
  }
}

class OtherSubClass extends BaseClass {
  // 继承 BaseClass 的构造函数
}

// In BaseClass constructor
$obj = new BaseClass();

// In BaseClass constructor
// In SubClass constructor
$obj = new SubClass();

// In BaseClass constructor
$obj = new OtherSubClass();
?>

<p>自 PHP 5.3.3 起，在命名空间中，与类名同名的方法不再作为构造函数。不使用命名空间中的类则不受影响。 构造函数是一个普通的方法，在对应对象实例化时自动被调用。 因此可以定义任何数量的参数，可以是必选、可以有类型、可以有默认值。 构造器的参数放在类名后的括号里调用。</p>
<p><strong>示例 #2 使用构造器参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Point &#123; </span><br><span class="line">protected int $x;  protected int $y; </span><br><span class="line">public function __construct(int $x, int $y = 0) &#123;   </span><br><span class="line">$this-&gt;x = $x;  </span><br><span class="line">$this-&gt;y = $y;  &#125;&#125;</span><br><span class="line">// 两个参数都传入</span><br><span class="line">$p1 = new Point(4, 5);</span><br><span class="line">// 仅传入必填的参数。</span><br><span class="line">$y 会默认取值 0。$p2 = new Point(4);</span><br><span class="line">// 使用命名参数（PHP 8.0 起）:</span><br><span class="line">$p3 = new Point(y: 5, x: 4);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如果一个类没有构造函数，以及构造函数的参数不是必填项时，括号就可以省略。</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="3-魔术方法（magic函数）"><a href="#3-魔术方法（magic函数）" class="headerlink" title="3.魔术方法（magic函数）"></a>3.魔术方法（magic函数）</h2><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>php魔术方法是指在php中所有以 “__”也就是两个下划线开头的类方法保留为魔术方法，在命名自己的类方法时不能使用魔术方法名，除非是想使用其魔术功能。</p>
<h4 id="功能是什么"><a href="#功能是什么" class="headerlink" title="功能是什么"></a>功能是什么</h4><p>__construct()， __destruct()， __call()， __callStatic()， __get()， __set()， __isset()， __unset()， __sleep()， __wakeup()， __toString()， __invoke()， __set_state()， __clone() 和 __debugInfo() 等方法在 PHP 中被称为魔术方法（Magic methods）。在命名自己的类方法时不能使用这些方法名，除非是想使用其魔术功能。</p>
<h4 id="常见函数魔术功能"><a href="#常见函数魔术功能" class="headerlink" title="常见函数魔术功能"></a>常见函数魔术功能</h4><p>void __wakeup（void )</p>
<p>unserialize( )会检查是否存在一个_wakeup( ) 方法。如果存在，则会先调用_wakeup 方法，预先准备对象需要的资源。</p>
<p>void __construct ([ mixed $args [, $… ]])</p>
<p>具有构造函数的类会在每次创建新对象时先调用此方法。</p>
<p>void __destruct ( void )</p>
<p>析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。</p>
<p>public string __toString ( void )</p>
<p>__toString( ) 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj;应该显示些什么。</p>
<p>此方法必须返回一个字符串，否则将发出一条 E_RECOVERABLE_ERROR 级别的致命错误。</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.serialize.php">serialize()</a> 函数会检查类中是否存在一个魔术方法 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 <strong><code>null</code></strong> 被序列化，并产生一个 <strong><code>E_NOTICE</code></strong> 级别的错误。</p>
<blockquote>
<p><strong>注意</strong>:</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a> 不能返回父类的私有成员的名字。这样做会产生一个 <strong><code>E_NOTICE</code></strong> 级别的错误。使用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.serialize">__serialize()</a> 接口替代。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a> 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</p>
<p>与之相反，<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.unserialize.php">unserialize()</a> 会检查是否存在一个 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a> 方法。如果存在，则会先调用 <code>__wakeup</code> 方法，预先准备对象需要的资源。</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a> 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/li_lening/article/details/81141349">一些魔术函数的使用</a></p>
<h2 id="4-考点（ctf题目）"><a href="#4-考点（ctf题目）" class="headerlink" title="4.考点（ctf题目）"></a>4.考点（ctf题目）</h2><p>这里先写一些，以后遇到题目再补充。</p>
<p>一些trick</p>
<h4 id="姿势学习"><a href="#姿势学习" class="headerlink" title="姿势学习"></a>姿势学习</h4><h5 id="1-wakeup-函数绕过"><a href="#1-wakeup-函数绕过" class="headerlink" title="1.__wakeup()函数绕过"></a>1.__wakeup()函数绕过</h5><p>wakeup()方法中对属性进行初始化或者改变。</p>
<p>当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过wakeup的执行。</p>
<p>这个大家应该都知道很常见的姿势了。</p>
<p>影响版本：</p>
<ul>
<li>PHP before 5.6.25</li>
<li>7.x before 7.0.10</li>
</ul>
<h5 id="2-oc-d-i"><a href="#2-oc-d-i" class="headerlink" title="2./[oc]:\d+:/i"></a>2./[oc]:\d+:/i</h5><p>OC:正则表达式,是对字符串操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。<br>\d+:/i是什么意思呢</p>
<p>\d:  匹配一个数字字符。等价于 [0-9]。<br> +:  匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。<br>/i:  表示匹配的时候不区分大小写</p>
<p>所以正则表达式就是查看是否有数字。<br>下面的正则表达式</p>
<p>if (preg_match(‘/[oc]:\d+:/i’, $var)) {<br>        die(‘stop hacking!’);<br>    } else {<br>        @unserialize($var);<br>    }<br>因为反序列化是有数字的，所以要怎么绕过呢？<br>方法：放一个加号可以直接退出序列处理，从而绕过正则匹配。</p>
<p>O:+7:”Student”:1:{s:1:”a”;i:123;}</p>
<h5 id="3-php反序列化逃逸"><a href="#3-php反序列化逃逸" class="headerlink" title="3.php反序列化逃逸"></a>3.php反序列化逃逸</h5><p>1.}后的东西不会被解析<br>例如：</p>
<p>$a=’O:7:”Student”:1:{s:1:”a”;i:123;}12312121’;<br>var_dump(unserialize($a));</p>
<p>这串代码经过反序列化后会变成这样</p>
<p>object(__PHP_Incomplete_Class)#1 (2) { [“__PHP_Incomplete_Class_Name”]=&gt; string(7) “Student” [“a”]=&gt; int(123) } </p>
<p>其中后面的12312121不会显示</p>
<p>反序列化逃逸怎么来呢？网站一般会在输入框会验证是否输入合法的字符，如果不合法，有些网站可能会把不合法的字符给替换掉，然后把输入的值进行反序列化，这就造成了反序列化逃逸漏洞。</p>
<p>例如：</p>
<p>function filter($str){<br>$filter=’/hack/i’;//替换hack成为itiswrong<br>    return preg_replace($filter, ‘itiswrong’, $str);<br>}<br>class login{<br>    public $name=’testi’;<br>    public $password=’123456’;<br>}<br>}<br>替换后字符串增加和替换后字符串减少的两种情况，其对应的逃逸方法也各不相同</p>
<h4 id="替换后字符串增加"><a href="#替换后字符串增加" class="headerlink" title="替换后字符串增加"></a>替换后字符串增加</h4><p>（这个博主讲的很适合我这个小白，所以我拷下来了）</p>
<p>我们先构造下图代码来测试</p>
<?php
function filter($str){
$filter='/hack/i';
    return preg_replace($filter, 'itiswrong', $str);
}
class login{
    public $name='testi';
    public $password='123456';
}

$login=new login();
$out1=serialize($login);
$res=filter(serialize($login));
echo $out1;
echo "<br />";
echo $res;
echo "<br />";
$qq=unserialize($res);

echo "name:";
echo $qq->name;
echo "<br />";
echo "password:";
echo $qq->password;
?>

<p>运行后，name里面未加hack就是第一张图，加了hack就是第二张图<br>我们不难发现，第二张图替换后长度和字符串不对应，导致后面name和password读不出来，这就是漏洞所在。</p>
<p>我们可以在name这一输入框（假设有，代码里没实现）构造一个特殊的字符串，再使用}把后面的password给弄掉，使之不能读取，就实现了改密码的功能。</p>
<h5 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20150141.png" alt="屏幕截图 2022-01-30 150141"></h5><p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20150151.png" alt="屏幕截图 2022-01-30 150151"></p>
<p>由于要替换password，但因为替换前是hack，替换后是itiswrong，多了5个字符，那我们要构造5的倍数的字符串。</p>
<p>所以在name里加进去一个”;s:8:”password”;s:5:”12345”;}（长度为30，密码随便改，但要符合替换长度）</p>
<p>30/5=6，所以我们构造6个hack，每一个本身与新换的相互抵消，还多出5乘六=30能抵消。至此，攻击代码如下</p>
<p>hackhackhackhackhackhacktesti”;s:8:”password”;s:5:”12345”;}<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20150307.png" alt="屏幕截图 2022-01-30 150307"></p>
<p>替换后字符串减少<br>还是使用上面的代码，但是改为由hack替换成no<br>初始密码由123456改为12345，方便一些</p>
<p>这种该怎么办呢？<br>由于前面name缩水，在name处进行逃逸已经不行了，所以我们选择在password处进行逃逸。<br>构造特殊的字符，使name那一栏把password那一栏的值给吃掉，然后在password处构造新密码，最后}结尾，就逃逸成功了啊<br>&lt;?php<br>function filter($str){<br>$filter=’/hack/i’;<br>    return preg_replace($filter, ‘no’, $str);<br>}<br>class login{<br>    public $name=’testi’;<br>    public $password=’12345’;<br>}</p>
<p>$login=new login();<br>$out1=serialize($login);<br>$res=filter(serialize($login));<br>echo $out1;<br>echo “<br />“;<br>echo $res;<br>echo “<br />“;<br>$qq=unserialize($res);</p>
<p>echo “name:”;<br>echo $qq-&gt;name;<br>echo “<br />“;<br>echo “password:”;<br>echo $qq-&gt;password;<br>?&gt;</p>
<p>我们要吞掉了字符串是</p>
<p>“;s:8:”password”;s:5:”12345（总共27）这里注意，往password框中填入逃逸代码后会使原始的5增长到两位数，所以前面吞的数量要加1<br>hack替换成no总共少2个<br>所以28/2=14<br>我们构造14个hack即可<br>所以最终在name处构造</p>
<p>hackhackhackhackhackhackhackhackhackhackhackhackhackhacktesti<br>在password处构造</p>
<p>12345”;s:8:”password”;s:4:”1234”;}<br>构造成功截图（其中灰色代表实际上被吞掉的数量，总共28位）<br>可以看到密码被改成1234，成功逃逸</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-01-30%20193848.png" alt="屏幕截图 2022-01-30 193848"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">shianer</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2022/01/30/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%881%EF%BC%89/">http://example.com/2022/01/30/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%881%EF%BC%89/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">shianer</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                                    <span class="chip bg-color">php反序列化</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/31/bugku-1/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="bugku(1)">
                        
                        <span class="card-title">bugku(1)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-31
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            shianer
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf%E9%A2%98%E7%9B%AE-web/">
                        <span class="chip bg-color">ctf题目--web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/28/web-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="web-攻防世界（1）">
                        
                        <span class="card-title">web-攻防世界（1）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            shianer
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ctf%E9%A2%98%E7%9B%AE-web/">
                        <span class="chip bg-color">ctf题目--web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>






    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">shianer</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/shianer" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:292595085@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=292595085" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 292595085" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
	
     <!--动态线条背景-->
     <script type="text/javascript"
     color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
     </script>	
	

</body>

</html>
